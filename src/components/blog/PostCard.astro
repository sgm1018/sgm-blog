---
import { Calendar, Clock, ChevronRight } from 'lucide-astro';
import type { BlogPost } from '../../types/blog.types';
import { formatDate } from '../../lib/utils';
import Card from '../ui/Card.astro';
import Badge from '../ui/Badge.astro';
import Button from '../ui/Button.astro';
import AuthorCard from './AuthorCard.astro';

export interface Props {
  post: BlogPost;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
---

<Card 
  class={`group ${featured ? 'md:col-span-2 md:row-span-2' : ''}`}
  hover={true}
  padding="none"
>
  <article class="h-full flex flex-col">
    {post.featuredImage && (
      <div class={`relative overflow-hidden ${featured ? 'h-64 md:h-80' : 'h-48'}`}>
        <img
          src={post.featuredImage}
          alt={post.title}
          class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
          loading="lazy"
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent"></div>
      </div>
    )}

    <div class={`p-6 flex-1 flex flex-col ${featured ? 'md:p-8' : ''}`}>
      <!-- Categories and Tags -->
      <div class="flex flex-wrap gap-2 mb-4">
        {post.category && (
          <Badge variant="primary" size="sm">
            {post.category.name}
          </Badge>
        )}
        {post.tags && post.tags.slice(0, featured ? 3 : 2).map((tag) => (
          <Badge variant="default" size="sm">
            #{tag.name}
          </Badge>
        ))}
      </div>

      <!-- Title and Excerpt -->
      <h2 class={`font-bold text-gray-900 dark:text-white mb-3 group-hover:text-primary-600 dark:group-hover:text-primary-400 transition-colors ${featured ? 'text-2xl md:text-3xl' : 'text-xl'}`}>
        <a href={`/blog/${post.slug}`} class="block">
          {post.title}
        </a>
      </h2>

      <p class={`text-gray-600 dark:text-gray-400 mb-6 flex-1 ${featured ? 'text-lg leading-relaxed' : 'text-base'}`}>
        {post.excerpt}
      </p>

      <!-- Meta Information and Author -->
      <div class="space-y-4 mb-4">
        <!-- Author Section -->
        <AuthorCard 
          author={post.author} 
          variant="inline" 
          size="sm" 
          showBio={true}
        />

        <!-- Post Meta -->
        <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
          <div class="flex items-center space-x-4">
            <div class="flex items-center space-x-1">
              <Calendar size={14} />
              <span>{formatDate(post.publishedAt)}</span>
            </div>
            <div class="flex items-center space-x-1">
              <Clock size={14} />
              <span>{post.readingTime} min</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Read More Button -->
      <Button 
        href={`/blog/${post.slug}`}
        variant="outline"
        size={featured ? 'md' : 'sm'}
        class="self-start group"
      >
        Leer m√°s
        <ChevronRight size={16} class="ml-2 group-hover:translate-x-1 transition-transform" />
      </Button>
    </div>
  </article>
</Card>